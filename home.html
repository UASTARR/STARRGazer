<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Enhanced Dashboard</title>
<style>
  * { box-sizing: border-box; }
  body, html { margin: 0; padding: 0; height: 100%; font-family: "Lato", sans-serif; }

  /* Header (fixed) */
  header {
    width: 100%;
    height: 80px;
    background-color: #333;
    color: white;
    font-size: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: fixed;
    top: 0;
    left: 0;
    z-index: 1200;
  }

  /* Sidebar tabs (right) */
  .tab {
    position: fixed;
    top: 80px;
    right: 0;
    width: 20%;
    height: calc(100% - 80px);
    background-color: #f1f1f1;
    border-left: 1px solid #ccc;
    overflow-y: auto;
    z-index: 1100;
  }

  .tab button {
    display: block;
    background-color: inherit;
    color: black;
    padding: 18px 12px;
    width: 100%;
    border: none;
    outline: none;
    text-align: left;
    cursor: pointer;
    transition: 0.12s;
    font-size: 16px;
  }

  .tab button:hover { background-color: #ddd; }
  .tab button.active { background-color: #ccc; }

  /* Blue placeholder area */
  #placeholder {
    display: flex;
    justify-content: center;
    align-items: center;
    position: fixed;
    top: 80px;
    left: 0;
    width: 80%;
    height: calc(100% - 80px);
    background-color: #cce6ff;
    font-size: 22px;
    color: #333;
    z-index: 100;
  }

  /* Tab cards (hidden by default) */
  .tabcontent {
    display: none;               /* hidden initially */
    position: absolute;          /* placed inside blue area using top/left/width/height */
    background-color: #fff;      /* white card */
    border: 1px solid #ccc;
    border-radius: 6px;
    overflow: auto;              /* scroll inside card if needed */
    padding: 12px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.12);
  }

  /* Map should be under non-map tabs so other tabs and their buttons are clickable */
  #Map { z-index: 200; background-color: #fff; pointer-events: auto; }

  /* All non-map tabs should sit above the map */
  .tabcontent:not(#Map) { z-index: 400; pointer-events: auto; }

  .tab-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    border-bottom: 1px solid #eee;
    padding-bottom: 6px;
  }

  .close-btn {
    font-size: 22px;
    font-weight: bold;
    background: none;
    border: none;
    cursor: pointer;
    color: #777;
    line-height: 1;
    padding: 0 6px;
  }
  .close-btn:hover { color: #000; }

  /* small-screen adjustments */
  @media (max-width: 800px) {
    .tab { width: 25%; }
    #placeholder { width: 75%; }
  }
</style>
</head>
<body>

<header>STARR Alberio</header>

<div class="tab">
  <button class="tablinks" onclick="openTab(event,'GroundSpeed')">Ground Speed</button>
  <button class="tablinks" onclick="openTab(event,'Altitude')">Altitude</button>
  <button class="tablinks" onclick="openTab(event,'Temperature')">Temperature</button>
  <button class="tablinks" onclick="openTab(event,'GPS')">GPS</button>
  <button class="tablinks" onclick="openTab(event,'Pressure')">Pressure</button>
  <button class="tablinks" onclick="openTab(event,'Map')">Map</button>
  <button class="tablinks" onclick="openTab(event,'Gyro')">Gyro</button>
</div>

<div id="placeholder">Select a tab to view data</div>

<!-- Tab contents -->
<div id="GroundSpeed" class="tabcontent">
  <div class="tab-header"><h3 style="margin:0;">Ground Speed</h3><button class="close-btn" onclick="closeTab('GroundSpeed')">×</button></div>
  <p>Displays the current speed of the vehicle or object.</p>
</div>

<div id="Altitude" class="tabcontent">
  <div class="tab-header"><h3 style="margin:0;">Altitude</h3><button class="close-btn" onclick="closeTab('Altitude')">×</button></div>
  <p>Shows the current altitude above sea level.</p>
</div>

<div id="Temperature" class="tabcontent">
  <div class="tab-header"><h3 style="margin:0;">Temperature</h3><button class="close-btn" onclick="closeTab('Temperature')">×</button></div>
  <p>Displays the current temperature reading.</p>
</div>

<div id="GPS" class="tabcontent">
  <div class="tab-header"><h3 style="margin:0;">GPS</h3><button class="close-btn" onclick="closeTab('GPS')">×</button></div>
  <p>Shows GPS coordinates and location information.</p>
</div>

<div id="Pressure" class="tabcontent">
  <div class="tab-header"><h3 style="margin:0;">Pressure</h3><button class="close-btn" onclick="closeTab('Pressure')">×</button></div>
  <p>Displays atmospheric pressure readings.</p>
</div>

<div id="Map" class="tabcontent">
  <div class="tab-header"><h3 style="margin:0;">Map</h3><button class="close-btn" onclick="closeTab('Map')">×</button></div>
  <p>Shows a map with the object's position (map canvas would go here).</p>
</div>

<div id="Gyro" class="tabcontent">
  <div class="tab-header"><h3 style="margin:0;">Gyro</h3><button class="close-btn" onclick="closeTab('Gyro')">×</button></div>
  <p>Shows Gyroscope readings.</p>
</div>

<script>
  // Robust, self-contained script
  let tabQueue = [];
  const MAX_TABS = 2;
  const HEADER_H = 80; // px (keeps tabs below header)

  function openTab(evt, tabName) {
    // handle evt possibly being undefined (callers may call openTab(null, name))
    if (tabQueue.includes(tabName)) {
      bringTabToFront(tabName);
    } else {
      // Enforce FIFO for non-Map tabs
      if (tabName !== 'Map' && tabQueue.filter(t => t !== 'Map').length >= MAX_TABS) {
        const oldest = tabQueue.filter(t => t !== 'Map').pop();
        closeTab(oldest, true);
      }
      tabQueue.unshift(tabName);
    }

    layoutTabs();
    activateTab(tabName);
    updateTabButtons(evt);
  }

  function closeTab(tabName, internal = false) {
    removeTabFromQueue(tabName);
    const el = document.getElementById(tabName);
    if (el) {
      el.style.display = 'none';
      // clear inline layout to avoid stale styles
      el.style.top = '';
      el.style.left = '';
      el.style.width = '';
      el.style.height = '';
      el.style.position = '';
    }
    const btn = document.querySelector(`button[onclick*="${tabName}"]`);
    if (btn) btn.classList.remove('active');

    layoutTabs();

    if (!internal) {
      if (tabQueue.length === 0) {
        document.getElementById('placeholder').style.display = 'flex';
      } else {
        activateTab(tabQueue[0]);
      }
    }
  }

  function removeTabFromQueue(tabName) {
    const i = tabQueue.indexOf(tabName);
    if (i > -1) tabQueue.splice(i, 1);
  }

  function bringTabToFront(tabName) {
    removeTabFromQueue(tabName);
    tabQueue.unshift(tabName);
  }

  function layoutTabs() {
    // hide all
    document.querySelectorAll('.tabcontent').forEach(t => {
      t.style.display = 'none';
    });

    const hasMap = tabQueue.includes('Map');
    const nonMap = tabQueue.filter(t => t !== 'Map');

    const availableHeight = `calc(100% - ${HEADER_H}px)`;
    const halfHeight = `calc((${availableHeight}) / 2)`;
    const fullBlueWidth = '80%';
    const leftHalf = '50%';

    // CASE A: Map open and no other tabs => fill full blue area
    if (hasMap && nonMap.length === 0) {
      const mapEl = document.getElementById('Map');
      mapEl.style.display = 'block';
      mapEl.style.position = 'absolute';
      mapEl.style.left = '0';
      mapEl.style.top = `${HEADER_H}px`;
      mapEl.style.width = fullBlueWidth;
      mapEl.style.height = availableHeight;
      mapEl.style.zIndex = 200;
    }
    // CASE B: Map + others => map left half, others stacked on right half
    else if (hasMap) {
      const mapEl = document.getElementById('Map');
      mapEl.style.display = 'block';
      mapEl.style.position = 'absolute';
      mapEl.style.left = '0';
      mapEl.style.top = `${HEADER_H}px`;
      mapEl.style.width = leftHalf;
      mapEl.style.height = availableHeight;
      mapEl.style.zIndex = 200;

      nonMap.slice(0, MAX_TABS).forEach((name, idx) => {
        const el = document.getElementById(name);
        if (!el) return;
        el.style.display = 'block';
        el.style.position = 'absolute';
        el.style.left = leftHalf;
        // right half relative to full blue zone
        el.style.width = `calc(${fullBlueWidth} - ${leftHalf})`;
        el.style.top = `calc(${HEADER_H}px + ${idx} * ${halfHeight})`;
        el.style.height = halfHeight;
        el.style.zIndex = 400;
      });
    }
    // CASE C: No map => non-map tabs stacked filling blue area
    else {
      nonMap.slice(0, MAX_TABS).forEach((name, idx) => {
        const el = document.getElementById(name);
        if (!el) return;
        el.style.display = 'block';
        el.style.position = 'absolute';
        el.style.left = '0';
        el.style.width = fullBlueWidth;
        el.style.top = `calc(${HEADER_H}px + ${idx} * ${halfHeight})`;
        el.style.height = halfHeight;
        el.style.zIndex = 400;
      });
    }

    // placeholder toggle
    document.getElementById('placeholder').style.display = tabQueue.length === 0 ? 'flex' : 'none';
  }

  function activateTab(tabName) {
    document.querySelectorAll('.tablinks').forEach(b => b.classList.remove('active'));
    const b = document.querySelector(`button[onclick*="${tabName}"]`);
    if (b) b.classList.add('active');
  }

  function updateTabButtons(evt) {
    if (!evt || !evt.currentTarget) return;
    document.querySelectorAll('.tablinks').forEach(b => b.classList.remove('active'));
    evt.currentTarget.classList.add('active');
  }

  // Ensure page starts clean
  window.addEventListener('load', () => {
    document.querySelectorAll('.tabcontent').forEach(t => t.style.display = 'none');
    document.getElementById('placeholder').style.display = 'flex';
    tabQueue = [];
  });
</script>
</body>
</html>
